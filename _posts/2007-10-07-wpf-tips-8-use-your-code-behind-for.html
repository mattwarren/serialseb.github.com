---
layout: post
title: 'WPF Tips''n''Tricks #8: Use your code-behind for binding'
date: '2007-10-07T12:10:00.001+01:00'
author: Sebastien Lambla
tags:
- WPF
- .net3
modified_time: '2007-10-07T12:10:45.440+01:00'
blogger_id: tag:blogger.com,1999:blog-4015568221071268916.post-9200733471932633907
blogger_orig_url: http://serialseb.blogspot.com/2007/10/wpf-tips-8-use-your-code-behind-for.html
---

<p>In the <a href="http://blogs.msdn.com/dancre/archive/2006/10/11/datamodel-view-viewmodel-pattern-series.aspx" rel="nofollow">View-ViewModel-DataModel pattern that has been documented a fair bit</a> for WPF, it is often the case that you want to have a testable class that wraps your data to expose an object model that will make binding from Xaml code easier. However, when writing prototyping or simply answering messages on the Msdn forums, as well as for the code examples on my blog, it's often the case that you want to have a sort-of ViewModel that you want to quickly hack together.</p> <p>The solution is to simply leverage the code-behind of your window! Let's create a simple property on our window code-behind.</p> <div style="font-size: 10pt; background: white; color: black; font-family: consolas, courier new"> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">partial</span> <span style="color: blue">class</span> <span style="color: #2b91af">MainWindow</span> : <span style="color: #2b91af">Window</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> MainWindow()</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InitializeComponent();</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">bool</span> IsFlagSet</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">bool</span>)GetValue(_isFlagSetProperty); }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">set</span> { SetValue(_isFlagSetProperty, <span style="color: blue">value</span>); }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">DependencyProperty</span> _isFlagSetProperty =</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">DependencyProperty</span>.Register(<span style="color: #a31515">"IsFlagSet"</span>, <span style="color: blue">typeof</span>(<span style="color: blue">bool</span>), <span style="color: blue">typeof</span>(<span style="color: #2b91af">MainWindow</span>), <span style="color: blue">new</span> <span style="color: #2b91af">FrameworkPropertyMetadata</span>(<span style="color: blue">false</span>));</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p></div> <p>And now in the Xaml code you just need to bind the DataContext property to the class itself.</p> <div style="font-size: 10pt; background: white; color: black; font-family: consolas, courier new"> <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">Window</span><span style="color: red"> x</span><span style="color: blue">:</span><span style="color: red">Class</span><span style="color: blue">="CaffeineIT.Blog.XamlCollections.MainWindow"</span></p> <p style="margin: 0px">&nbsp; <span style="color: red">xmlns</span><span style="color: blue">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></p> <p style="margin: 0px">&nbsp; <span style="color: red">xmlns</span><span style="color: blue">:</span><span style="color: red">x</span><span style="color: blue">="http://schemas.microsoft.com/winfx/2006/xaml"</span></p> <p style="margin: 0px">&nbsp; <span style="color: red">DataContext</span><span style="color: blue">="{</span><span style="color: #a31515">Binding</span><span style="color: red"> RelativeSource</span><span style="color: blue">={</span><span style="color: #a31515">RelativeSource</span><span style="color: red"> Self</span><span style="color: blue">}}"&gt;</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;</span><span style="color: #a31515">TextBlock</span><span style="color: blue">&gt;</span><span style="color: #a31515">The flag value is:</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;</span><span style="color: #a31515">TextBlock</span><span style="color: red"> Text</span><span style="color: blue">="{</span><span style="color: #a31515">Binding</span><span style="color: red"> Path</span><span style="color: blue">=IsFlagSet}"/&gt;</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;/</span><span style="color: #a31515">TextBlock</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">Window</span><span style="color: blue">&gt;</span></p></div> <p>Voila! You can now bind straight to the properties defined on your Window class! But as the complexity of your project increases, you'll want to unit test the ViewModel, and for this you'll have to separate the code in a separate class. The way I choose to do it is to embed the object directly inside the Xaml code. With this approach, you'll have the a ViewModel class. Here I implement it by inheriting from DependencyObject to keep the DP we defined earlier, as it provides support for validate and coerce callbacks, but this is absolutely not necessary. You're more than welcome to implement your property through accessors and INotifyPropertyChanged.</p> <div style="font-size: 10pt; background: white; color: black; font-family: consolas, courier new"> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">NewWindowViewModel</span> : <span style="color: #2b91af">DependencyObject</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">bool</span> IsFlagSet</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span> (<span style="color: blue">bool</span>)GetValue(_isFlagSetProperty); }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">set</span> { SetValue(_isFlagSetProperty, <span style="color: blue">value</span>); }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">DependencyProperty</span> _isFlagSetProperty =</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">DependencyProperty</span>.Register(<span style="color: #a31515">"IsFlagSet"</span>, <span style="color: blue">typeof</span>(<span style="color: blue">bool</span>), <span style="color: blue">typeof</span>(<span style="color: #2b91af">NewWindowViewModel</span>), <span style="color: blue">new</span> <span style="color: #2b91af">PropertyMetadata</span>(<span style="color: blue">false</span>));</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p></div> <p>And now I can declare this object in my Xaml.</p> <div style="font-size: 10pt; background: white; color: black; font-family: consolas, courier new"> <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">Window</span><span style="color: red"> x</span><span style="color: blue">:</span><span style="color: red">Class</span><span style="color: blue">="CaffeineIT.Blog.ViewModel.NewWindow"</span></p> <p style="margin: 0px">&nbsp; <span style="color: red">xmlns</span><span style="color: blue">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></p> <p style="margin: 0px">&nbsp; <span style="color: red">xmlns</span><span style="color: blue">:</span><span style="color: red">x</span><span style="color: blue">="http://schemas.microsoft.com/winfx/2006/xaml"</span></p> <p style="margin: 0px">&nbsp; <span style="color: red">xmlns</span><span style="color: blue">:</span><span style="color: red">vm</span><span style="color: blue">="clr-namespace:CaffeineIT.Blog.ViewModel"</span><span style="color: red"> DataContext</span><span style="color: blue">="{</span><span style="color: #a31515">DynamicResource</span><span style="color: red"> ViewModel</span><span style="color: blue">}"&gt;</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;</span><span style="color: #a31515">Window.Resources</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;</span><span style="color: #a31515">vm</span><span style="color: blue">:</span><span style="color: #a31515">NewWindowViewModel</span><span style="color: red"> x</span><span style="color: blue">:</span><span style="color: red">Key</span><span style="color: blue">="ViewModel" /&gt;</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;/</span><span style="color: #a31515">Window.Resources</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;</span><span style="color: #a31515">TextBlock</span><span style="color: blue">&gt;</span><span style="color: #a31515">The flag value is:</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;</span><span style="color: #a31515">TextBlock</span><span style="color: red"> Text</span><span style="color: blue">="{</span><span style="color: #a31515">Binding</span><span style="color: red"> Path</span><span style="color: blue">=IsFlagSet}"/&gt;</span></p> <p style="margin: 0px"><span style="color: #a31515">&nbsp;&nbsp;&nbsp; </span><span style="color: blue">&lt;/</span><span style="color: #a31515">TextBlock</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">Window</span><span style="color: blue">&gt;</span></p></div> <p>I find the code very tidy. Through this mechanism, you can also bind properties from your view to the ViewModel. Imagine: View updates ViewModel updates View... You can abstract all the logic of your view in your ViewModel in an oh-so-clean way it makes me salivate every time. You can then leverage commands to encapsulate actions that modifies the ViewModel which update the View. No more tier leakage!</p> <div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:b3ce6e4d-4c6f-4436-97b9-3801cff59145" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati Tags: <a href="http://technorati.com/tags/wpf" rel="tag">wpf</a>, <a href="http://technorati.com/tags/.net" rel="tag">.net</a>, <a href="http://technorati.com/tags/.net3" rel="tag">.net3</a>, <a href="http://technorati.com/tags/.net35" rel="tag">.net35</a></div> 