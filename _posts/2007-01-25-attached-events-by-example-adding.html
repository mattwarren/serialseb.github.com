---
layout: post
title: Attached Events By Example - Adding an Activate event to any Selector element
  (ListView, ListBox, TreeView, etc...)
date: '2007-01-25T02:17:00.001Z'
author: Sebastien Lambla
tags: 
modified_time: '2007-01-25T02:17:07.001Z'
blogger_id: tag:blogger.com,1999:blog-4015568221071268916.post-8698983045963396946
blogger_orig_url: http://serialseb.blogspot.com/2007/01/attached-events-by-example-adding.html
---

<p>I couldn't resist using a long title. I've had this article&nbsp;on the back of my mind for a while but only managed to get in the mood for a big writing session tonight, after a glass of Stella and a soapy bath. Go figure.</p> <p>A common struggle with ListViews, TreeViews and other controls is the lack of an ItemActivate event like the one found in WinForms. Several solutions have been offered, most of them <a href="http://kentb.blogspot.com/2006/12/listviewitemactivated-event-in-wpf.html">involving inheriting</a> from these controls to add the missing functionality. In the spirit of Windows Presentation Foundation's (oh, Avalon, where art thou...) emphasis on composition, I thought I'd offer a generalized solution for any <a href="http://msdn2.microsoft.com/en-us/library/system.windows.controls.primitives.selector.aspx">Selector</a> control, with no need for inheritance,&nbsp;using a nearly unknown little gem called <em>attached events</em>.</p> <p>Attached events are not much talked about (<a href="http://blogs.msdn.com/nickkramer/archive/2005/05/19/420270.aspx">Nick mentions them</a> in passing), documented (<a href="http://msdn2.microsoft.com/en-us/library/ms742806.aspx#attached_events">msdn mentions</a> them in one paragraph), or printed about (as far as I can read, neither the <a href="http://www.microsoft.com/MSPress/books/6476.asp">Petzold</a> nor&nbsp;<a href="http://www.oreilly.com/catalog/avalon/index.html">Chris &amp; Ian's book</a> talk about them, although Ian&nbsp;mentioned to&nbsp;me it will be in the next version). So what is an attached event, and what is not? Let's start with what it is not.</p> <p><em>[Disclaimer: At core, attached events are just routed events used in a different way, and as such are more a pattern than an actual specific piece of technology. And as any pattern, they end up with a fancy name. Naming conventions are based on current msdn documentation, which may (and should) change in the future.]</em></p> <h4>Qualified Event Names</h4> <p>Often,&nbsp;when people think they use attached events, they in fact use Qualified Event Names. This special syntax lets you attach an event handler for a RoutedEvent anywhere in the tree above the element triggering that event. For example, the following code attaches the Click event triggered by the Button element type, but on its direct parent.</p><!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red163\green21\blue21;\red255\green0\blue0;\red0\green0\blue0;}??\fs18 \cf1 &lt;\cf3 Border\cf1  \cf4 Height\cf1 =\cf0 "\cf1 50\cf0 "\cf1  \cf4 Width\cf1 =\cf0 "\cf1 300\cf0 "\cf1  \cf4 BorderBrush\cf1 =\cf0 "\cf1 Gray\cf0 "\cf1  \cf4 BorderThickness\cf1 =\cf0 "\cf1 1\cf0 "\cf1 &gt;\par ??    &lt;\cf3 StackPanel\cf1  \cf4 Background\cf1 =\cf0 "\cf1 LightGray\cf0 "\cf1  \cf4 Orientation\cf1 =\cf0 "\cf1 Horizontal\cf0 "\cf1  \cf4 Button.Click\cf1 =\cf0 "\cf1 CommonClickHandler\cf0 "\cf1 &gt;\par ??        &lt;\cf3 Button\cf1  \cf4 Name\cf1 =\cf0 "\cf1 YesButton\cf0 "\cf1  \cf4 Width\cf1 =\cf0 "\cf1 Auto\cf0 "\cf1  &gt;\cf0 Yes\cf1 &lt;/\cf3 Button\cf1 &gt;\par ??        &lt;\cf3 Button\cf1  \cf4 Name\cf1 =\cf0 "\cf1 NoButton\cf0 "\cf1  \cf4 Width\cf1 =\cf0 "\cf1 Auto\cf0 "\cf1  &gt;\cf0 No\cf1 &lt;/\cf3 Button\cf1 &gt;\par ??        &lt;\cf3 Button\cf1  \cf4 Name\cf1 =\cf0 "\cf1 CancelButton\cf0 "\cf1  \cf4 Width\cf1 =\cf0 "\cf1 Auto\cf0 "\cf1  &gt;\cf0 Cancel\cf1 &lt;/\cf3 Button\cf1 &gt;\par ??    &lt;/\cf3 StackPanel\cf1 &gt;\par ??&lt;/\cf3 Border\cf1 &gt;\par ??}
--> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px"><span style="color: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;1</span>&nbsp;<span style="color: blue">&lt;</span><span style="color: #a31515">Border</span><span style="color: blue"> </span><span style="color: red">Height</span><span style="color: blue">=</span>"<span style="color: blue">50</span>"<span style="color: blue"> </span><span style="color: red">Width</span><span style="color: blue">=</span>"<span style="color: blue">300</span>"<span style="color: blue"> </span><span style="color: red">BorderBrush</span><span style="color: blue">=</span>"<span style="color: blue">Gray</span>"<span style="color: blue"> </span><span style="color: red">BorderThickness</span><span style="color: blue">=</span>"<span style="color: blue">1</span>"<span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;2</span>&nbsp;<span style="color: blue">&nbsp; &nbsp; &lt;</span><span style="color: #a31515">StackPanel</span><span style="color: blue"> </span><span style="color: red">Background</span><span style="color: blue">=</span>"<span style="color: blue">LightGray</span>"<span style="color: blue"> </span><span style="color: red">Orientation</span><span style="color: blue">=</span>"<span style="color: blue">Horizontal</span>"<span style="color: blue"> </span><span style="color: red">Button.Click</span><span style="color: blue">=</span>"<span style="color: blue">CommonClickHandler</span>"<span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;3</span>&nbsp;<span style="color: blue">&nbsp; &nbsp; &nbsp; &nbsp; &lt;</span><span style="color: #a31515">Button</span><span style="color: blue"> </span><span style="color: red">Name</span><span style="color: blue">=</span>"<span style="color: blue">YesButton</span>"<span style="color: blue"> </span><span style="color: red">Width</span><span style="color: blue">=</span>"<span style="color: blue">Auto</span>"<span style="color: blue"> &gt;</span>Yes<span style="color: blue">&lt;/</span><span style="color: #a31515">Button</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;4</span>&nbsp;<span style="color: blue">&nbsp; &nbsp; &nbsp; &nbsp; &lt;</span><span style="color: #a31515">Button</span><span style="color: blue"> </span><span style="color: red">Name</span><span style="color: blue">=</span>"<span style="color: blue">NoButton</span>"<span style="color: blue"> </span><span style="color: red">Width</span><span style="color: blue">=</span>"<span style="color: blue">Auto</span>"<span style="color: blue"> &gt;</span>No<span style="color: blue">&lt;/</span><span style="color: #a31515">Button</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;5</span>&nbsp;<span style="color: blue">&nbsp; &nbsp; &nbsp; &nbsp; &lt;</span><span style="color: #a31515">Button</span><span style="color: blue"> </span><span style="color: red">Name</span><span style="color: blue">=</span>"<span style="color: blue">CancelButton</span>"<span style="color: blue"> </span><span style="color: red">Width</span><span style="color: blue">=</span>"<span style="color: blue">Auto</span>"<span style="color: blue"> &gt;</span>Cancel<span style="color: blue">&lt;/</span><span style="color: #a31515">Button</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;6</span>&nbsp;<span style="color: blue">&nbsp; &nbsp; &lt;/</span><span style="color: #a31515">StackPanel</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;7</span>&nbsp;<span style="color: blue">&lt;/</span><span style="color: #a31515">Border</span><span style="color: blue">&gt;</span></p></div> <p>This syntax is the same you'll use for attached events, so it could be said that to add a listener to an attached event, you use the Qualified Event Name notation.</p> <h4>Attached Events</h4> <p>So what <em>are</em> attached events? Let's see what our friends at msdn have to say.</p> <blockquote> <p>An attached event allows you to attach a handler for a particular event to some child element rather than to the parent that actually defines the event, even though neither the object potentially raising the event nor the destination handling instance define or otherwise "own" that event in their namespace.</p></blockquote> <p>If you're like me, it takes a few readings to understand what it means. Let's take it one bit at a time. The first thing to realize is that we're talking about a normal routed event, declared the same way as usual.</p> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">RoutedEvent</span> ItemActivateEvent = </p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">EventManager</span>.RegisterRoutedEvent(<span style="color: fuchsia">"ItemActivate"</span>,</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">RoutingStrategy</span>.Bubble,</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">typeof</span>(<span style="color: #2b91af">RoutedEventHandler</span>),</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">typeof</span>(<span style="color: #2b91af">ItemActivation</span>));</p></div> <p>Then, it is said&nbsp;attached events&nbsp;are defined on an element. Actually they don't need to be defined on an element that is in your element tree at all, and not even on an element. For example, the Mouse class is a sealed class, and&nbsp;yet it&nbsp;defines all mouse-related attached events. What would be more accurate would be to say that the class defining the event is often neither the user of the event (whoever&nbsp;consumes it by adding&nbsp;a handler on it)&nbsp;nor the&nbsp;source of the event (whatever code raises it). For example, the previous attached event has been defined on my ItemActivation class.</p> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px"><span style="color: blue">namespace</span> SerialSeb.Windows.Controls</p> <p style="margin: 0px">{</p> <p style="margin: 0px">&nbsp; &nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">class</span> <span style="color: #2b91af">ItemActivation</span></p> <p style="margin: 0px">&nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; ...</p></div> <p>What is common to all attached events however, is the absence of an event declaration using the add{} and remove{}&nbsp;accessors to call AddHandler and RemoveHandler on the instance of the object. Instead, and I suppose it is by convention, two static methods are defined to achieve the adding and removing of an handler.</p> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> AddItemActivateHandler(<span style="color: #2b91af">DependencyObject</span> o, <span style="color: #2b91af">RoutedEventHandler</span> handler)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((<span style="color: #2b91af">UIElement</span>)o).AddHandler(<span style="color: #2b91af">ItemActivation</span>.ItemActivateEvent, handler);</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> RemoveItemActivateHandler(<span style="color: #2b91af">DependencyObject</span> o, <span style="color: #2b91af">RoutedEventHandler</span> handler)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((<span style="color: #2b91af">UIElement</span>)o).RemoveHandler(<span style="color: #2b91af">ItemActivation</span>.ItemActivateEvent, handler);</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; }</p></div> <p>You'll find that all attached events follow the same Add<em>EventName</em>Handler and Remove<em>EventName</em>Handler convention.</p> <p>The pieces of the puzzle start&nbsp;falling into place slowly. Of course, now that an event has been defined, you want to consume it. To do so, you want to add a handler for that event, but it's not defined on an element present in your tree. The following XAML code shows how it can be done. Note that you can of course add and remove&nbsp;handlers programmatically through the two methods you've defined.</p> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">Window</span><span style="color: blue"> </span><span style="color: red">xmlns</span><span style="color: blue">=</span>"<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"</p> <p style="margin: 0px"><span style="color: blue">&nbsp; &nbsp; </span><span style="color: red">xmlns:my</span><span style="color: blue">=</span>"<span style="color: blue">clr-namespace:SerialSeb.Windows.Controls</span>"<span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&nbsp; &nbsp; &lt;</span><span style="color: #a31515">Grid</span><span style="color: blue"> </span><span style="color: red">my:ItemActivation.ItemActivate</span><span style="color: blue">=</span>"<span style="color: blue">HandleItemActivate</span>"<span style="color: blue">&gt;</span></p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; ...</p> <p style="margin: 0px"><span style="color: blue">&nbsp; &nbsp; &lt;/</span><span style="color: #a31515">Grid</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">Window</span><span style="color: blue">&gt;</span></p></div> <p>I believe it strikes a phenomenal resemblance to the Qualified Event Name notation I mentioned&nbsp;earlier. Now, whenever the routed event ItemActivate we've defined earlier bubbles up&nbsp;from somewhere within the grid, it will be caught just like any normal routed event. After all, as I said before, this is just a normal routed event.</p> <p>We've seen how you declare an attached event, and how to add a handler for it anywhere on our tree. The big question is now to know who is going to raise it? Like any routed event, any code can raise this event, as long as it knows on which element it wants to start bubbling it.</p> <h4>Raising an Attached Event</h4> <p>Raising our ItemActivate event needs to be done whenever, within a Selector,&nbsp;a user double-click on an item, or presses the Enter key after selecting one. To do so, we need to attach some behavior to that element, and we're going to use <a href="http://blogs.msdn.com/dancre/archive/2006/03/04/543854.aspx">Dan Crevier's excellent attached property trick</a>.</p> <p>Whenever you declare an attached property, you can define a PropertyChangedCallback that will get called whenever the value of the property changes, and that includes the first time it's applied. And you get a reference to the element it's applied to, absolutely perfect to hook our behavior code to the Selector element!</p> <p>Let's start by defining the attached property in our ItemActivation class.</p> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">ActivationMode</span> GetActivationMode(<span style="color: #2b91af">DependencyObject</span> obj)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">return</span> (<span style="color: #2b91af">ActivationMode</span>)obj.GetValue(ActivationModeProperty);</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> SetActivationMode(<span style="color: #2b91af">DependencyObject</span> obj, <span style="color: #2b91af">ActivationMode</span> value)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; obj.SetValue(ActivationModeProperty, value);</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">DependencyProperty</span> ActivationModeProperty =</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">DependencyProperty</span>.RegisterAttached(<span style="color: fuchsia">"ActivationMode"</span>,&nbsp; </p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">typeof</span>(<span style="color: #2b91af">ActivationMode</span>),</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">typeof</span>(<span style="color: #2b91af">ItemActivation</span>),</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">new</span> <span style="color: #2b91af">FrameworkPropertyMetadata</span>(<span style="color: #2b91af">ActivationMode</span>.None,</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">ItemActivation</span>.HandleActivationModeChanged));</p></div> <p>Overall a very simple attached property called <em>ActivationMode</em>. The type is a simple enumeration defining what can trigger the raising of our event, Mouse, Keyboard or both. And finally, a call to our HandleActivationModeChanged static method that will provide for the subscription to the events we're interested in.</p> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">MouseButtonEventHandler</span> SelectorMouseDoubleClickHandler = <span style="color: blue">new</span> <span style="color: #2b91af">MouseButtonEventHandler</span>(<span style="color: #2b91af">ItemActivation</span>.HandleSelectorMouseDoubleClick);</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">KeyEventHandler</span> SelectorKeyDownHandler = <span style="color: blue">new</span> <span style="color: #2b91af">KeyEventHandler</span>(<span style="color: #2b91af">ItemActivation</span>.HandleSelectorKeyDown);</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">void</span> HandleActivationModeChanged(<span style="color: #2b91af">DependencyObject</span> target, <span style="color: #2b91af">DependencyPropertyChangedEventArgs</span> e)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">Selector</span> selector = target <span style="color: blue">as</span> <span style="color: #2b91af">Selector</span>;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">if</span> (target == <span style="color: blue">null</span>) <span style="color: green">// if trying to attach to something else than a Selector, just ignore</span></p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">return</span>;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">ActivationMode</span> newActivation = (<span style="color: #2b91af">ActivationMode</span>)e.NewValue;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">if</span> ((newActivation &amp; <span style="color: #2b91af">ActivationMode</span>.Mouse) == <span style="color: #2b91af">ActivationMode</span>.Mouse)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; selector.MouseDoubleClick += SelectorMouseDoubleClickHandler;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">if</span> ((newActivation &amp; <span style="color: #2b91af">ActivationMode</span>.Keyboard) == <span style="color: #2b91af">ActivationMode</span>.Keyboard)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; selector.KeyDown += SelectorKeyDownHandler;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">else</span></p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; selector.KeyDown -= SelectorKeyDownHandler;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; selector.MouseDoubleClick -= SelectorMouseDoubleClickHandler;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; }</p></div> <p>I defined two handlers for the KeyDown and the MouseDoubleClick events of our Selector. Only thing left to do is to raise our event when the user double-clicked on something.</p> <div style="font-size: 9pt; background: white; color: black; font-family: consolas"> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">static</span> <span style="color: blue">void</span> HandleSelectorMouseDoubleClick(<span style="color: blue">object</span> o, <span style="color: #2b91af">MouseButtonEventArgs</span> e)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; {</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">ItemsControl</span> sender = o <span style="color: blue">as</span> <span style="color: #2b91af">ItemsControl</span>;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">DependencyObject</span> originalSender = e.OriginalSource <span style="color: blue">as</span> <span style="color: #2b91af">DependencyObject</span>;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">if</span> (sender == <span style="color: blue">null</span> || originalSender == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #2b91af">DependencyObject</span> container = <span style="color: #2b91af">ItemsControl</span>.ContainerFromElement(sender <span style="color: blue">as</span> <span style="color: #2b91af">ItemsControl</span>, e.OriginalSource <span style="color: blue">as</span> <span style="color: #2b91af">DependencyObject</span>);</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green">// just in case, check if the double click doesn't come from somewhere else than something in a container</span></p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">if</span> (container == <span style="color: blue">null</span> || container == <span style="color: #2b91af">DependencyProperty</span>.UnsetValue) <span style="color: blue">return</span>;</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green">// found a container, now find the item.</span></p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">object</span> activatedItem = sender.ItemContainerGenerator.ItemFromContainer(container);</p> <p style="margin: 0px">&nbsp;</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue">if</span> (activatedItem != <span style="color: blue">null</span> &amp;&amp; activatedItem != <span style="color: #2b91af">DependencyProperty</span>.UnsetValue)</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sender.RaiseEvent(<span style="color: blue">new</span> <span style="color: #2b91af">ItemActivateEventArgs</span>(<span style="color: #2b91af">ItemActivation</span>.ItemActivateEvent, sender, activatedItem, <span style="color: #2b91af">ActivationMode</span>.Mouse));</p> <p style="margin: 0px">&nbsp; &nbsp; &nbsp; &nbsp; }</p></div> <p>&nbsp;We get the container (the one returned by the <a href="http://msdn2.microsoft.com/en-us/library/system.windows.controls.itemscontrol.itemtemplate.aspx\">ItemsControl.ItemTemplate property</a>), from which we can get the&nbsp;Item that is being represented by this fragment of the tree.</p> <p>And there you have it, we raise our attached event by calling the RaiseEvent method of our target element! Our attached event is now going to bubble&nbsp;from the Selector and you'll be able to catch it wherever you want in your tree.</p> <h4>Conclusion</h4> <p>We now have an ItemActivate routed event that can be used on any selector, by using attached properties and attached events. Through composition we've added behavior and functionality to a type without having to inherit from it.</p> <p>Next time, we'll learn how to bind a RoutedEvent to a Command anywhere in your XAML. Stay tuned...</p> <p><em>P.S. I'll post the complete code, with keyboard support, and tunneling PreviewItemActivate event when I find the time to set-up my other web sites. In the meantime, don't hesitate to copy and paste!</em></p>