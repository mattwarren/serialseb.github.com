---
layout: post
title: 'WPF Tips''n''Tricks #1: Have all your dates, times, numbers... in the local
  culture'
date: '2007-04-03T15:40:00.001+01:00'

tags: 
modified_time: '2007-04-04T11:19:00.221+01:00'
blogger_id: tag:blogger.com,1999:blog-4015568221071268916.post-8373882007347687607
blogger_orig_url: http://serialseb.blogspot.com/2007/04/wpf-tips-1-have-all-your-dates-times.html
---

<p><em>This is the first instance of a series where I'll try to publish at least&nbsp;</em></p> <div class="wlWriterSmartContent" id="0767317B-992E-4b12-91E0-4F059A8CECA8:17e1471f-e0fc-4734-a224-79d6578aca0e" contenteditable="false" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati tags: <a href="http://technorati.com/tags/wpf" rel="tag">wpf</a>, <a href="http://technorati.com/tags/localization" rel="tag">localization</a>, <a href="http://technorati.com/tags/bindings" rel="tag">bindings</a></div> <p><em>one trick a day you'll find useful in your .net 3 development life. Some of it I came up with myself, some of it comes from the forums. I'll make sure to give credit where credit is due :)</em></p> <p>WPF has a very annoying tendency. All dates are by default in the en-US format. You need to understand first why, and then I'll give a few potential solutions, and one that is now my favorite.</p> <p>You'll notice that UIElement has a property called Language. This property is supposed to define what language the element has been written in. That way, WPF can know when some content is en-US (American English), or en-GB (British English), etc. It is also bound to the xml:lang property you can set on any xml document.</p> <p>Now if you read the documentation the way I did, you realize that xml:lang by *default* is set to the empty string, and as such doesn't have any associated culture. But by default, the matching Language property has a default of... en-US! And because of the way bindings work, that's why all your dates will always show up in American English format.</p> <p>Whenever you bind an element's property&nbsp;to a DateTime object, the binding is going to&nbsp;covert the DateTime to the type of the property you're binding to. Take for example the following binding:</p> <div style="font-size: 10pt; background: white; color: black; font-family: consolas,courier new"> <p style="margin: 0px"><span style="color: blue">&lt;</span><span style="color: #a31515">Window</span><span style="color: blue"> </span><span style="color: red">xmlns</span><span style="color: blue">=</span>"<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"</p> <p style="margin: 0px"><span style="color: blue">&nbsp;&nbsp;&nbsp; </span><span style="color: red">xmlns:x</span><span style="color: blue">=</span>"<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml</span>"</p> <p style="margin: 0px"><span style="color: blue">&nbsp;&nbsp;&nbsp; </span><span style="color: red">xmlns:sys</span><span style="color: blue">=</span>"<span style="color: blue">clr-namespace:System;assembly=mscorlib</span>"<span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&nbsp;&nbsp;&nbsp; &lt;</span><span style="color: #a31515">Grid</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;</span><span style="color: #a31515">TextBlock</span><span style="color: blue"> </span><span style="color: red">Text</span><span style="color: blue">=</span>"<span style="color: blue">{Binding Path={x:Static sys:DateTime.Now}}</span>"<span style="color: blue"> /&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&nbsp;&nbsp;&nbsp; &lt;/</span><span style="color: #a31515">Grid</span><span style="color: blue">&gt;</span></p> <p style="margin: 0px"><span style="color: blue">&lt;/</span><span style="color: #a31515">Window</span><span style="color: blue">&gt;</span></p></div> <p>This will convert from DateTime to a String (the type of the Text property). But to do so, it is going to use a default converter. If you check the documentation for bindings, you'll see that you can specify an IValueConverter in the Converter property. And you'll also see a ConverterCulture property that specify which culture you want to use to convert your data, here our DateTime object.</p> <p>As I said before, without a Converter specified, WPF will find one automatically for you, either built-in ones or using the existing conversion infrastructure that has been around for now&nbsp;three versions. But guess what happens when you don't specify a ConverterCulture?</p> <p>WPF selects the culture of the Language property of the element on which the binding is applied. In our case, the default: <strong>en-US</strong> again!</p> <p>So here's my trick of the day. To ensure your application defaults to the current culture *on the client machine* and *at run time*, you can add one simple line in your App.xaml.cs.</p> <div style="font-size: 10pt; background: white; color: black; font-family: Consolas,courier new"> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">partial</span> <span style="color: blue">class</span> <span style="color: #2b91af">App</span> : <span style="color: #2b91af">Application</span></p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">static</span> App()</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af">FrameworkElement</span>.LanguageProperty.OverrideMetadata(</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">typeof</span>(<span style="color: #2b91af">FrameworkElement</span>), </p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">new</span> <span style="color: #2b91af">FrameworkPropertyMetadata</span>(</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af">XmlLanguage</span>.GetLanguage(<span style="color: #2b91af">CultureInfo</span>.CurrentCulture.IetfLanguageTag)));</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p></div> <p>What this bit of code does is override the default value of the Language property on all the FrameworkElement inherited classes in your application to the CurrentCulture of the computer you run on. In this case, we're interested in overriding this value so that any content is assumed by default to be in the language associated with the way you want your localization to be made. This is quite wrong, as explained by Michael in his <a href="http://blogs.msdn.com/michkap/archive/2007/01/11/1449754.aspx">Why we have both CurrentCulture and CurrentUICulture</a> post, but it's the solution approaching the most an acceptable outcome.</p> <p>As for what Microsoft probably should have done? Set by default the Binding.ConverterCulture property to the CultureInfo.CurrentCulture value. But that's just my opinion :)</p>